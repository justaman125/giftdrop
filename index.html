<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Catch the Gifts - Santa Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
body{height:100vh;background:linear-gradient(#0b1d3a,#112b55);color:#fff;overflow:hidden}
.screen{position:absolute;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;z-index:2}
.screen.active{display:flex}
button{padding:12px 24px;font-size:16px;border:none;border-radius:6px;cursor:pointer;background:#fff;color:#000;margin-top:10px}
#gameArea{position:relative;width:100%;height:100%}
.hud{position:absolute;top:10px;left:0;right:0;padding:0 20px;display:flex;justify-content:space-between;font-size:18px;z-index:5}
#multiplier{position:absolute;top:45px;left:20px}
#shieldEl{position:absolute;top:75px;left:20px;color:#0f0;display:none}
#fullscreenBtn{position:absolute;top:40px;right:20px;padding:6px 12px;font-size:14}
#menuBtn{position:absolute;top:100px;right:20px;padding:6px 12px;font-size:14;z-index:6}

/* Santa bag */
#player {position:absolute;bottom:20px;width:120px;height:30px;background:radial-gradient(circle at 50% 30%, #ff0000, #990000);border-radius:50% 50% 20% 20%;border:2px solid #660000;left:50%;transform:translateX(-50%);box-shadow:0 4px 8px rgba(0,0,0,0.5);}
#player::before {content:"";position:absolute;top:-6px;left:50%;width:60px;height:12px;background:radial-gradient(circle at 50% 50%, #ff6666, #cc0000);border-radius:50%;transform:translateX(-50%);}
#shieldBubble{position:absolute;width:130px;height:50px;border-radius:50%;border:3px solid #0f0;opacity:0.5;pointer-events:none;display:none;bottom:12px;left:50%;transform:translateX(-50%);z-index:3}

/* Gifts */
.gift{position:absolute;width:44px;height:44px;border-radius:6px;background:linear-gradient(145deg,#ff5a5a,#b30000);box-shadow:0 4px 8px rgba(0,0,0,.4)}
.ribbon-v{position:absolute;width:8px;height:100%;background:#ffd700;left:50%;transform:translateX(-50%)}
.ribbon-h{position:absolute;height:8px;width:100%;background:#ffd700;top:50%;transform:translateY(-50%)}
.bow{position:absolute;top:-6px;left:50%;width:20px;height:12px;transform:translateX(-50%)}
.bow:before,.bow:after{content:"";position:absolute;width:10px;height:12px;background:#ffd700;border-radius:50% 50% 0 0}
.bow:before{left:0}.bow:after{right:0}

/* Bomb */
.bomb{position:absolute;width:46px;height:46px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #666, #000);box-shadow:0 0 12px rgba(255,0,0,.8);}
.bomb::after{content:"";position:absolute;top:20px;left:6px;width:34px;height:6px;background:#ff3333}

/* Power-ups */
.powerup{position:absolute;width:40px;height:40px;border-radius:6px;box-shadow:0 4px 8px rgba(0,0,0,.5);text-align:center;font-size:18px;line-height:40px;font-weight:bold;color:#fff;}
.power-multiplier{background:gold;color:#000;}
.power-time{background:deepskyblue;}
.power-magnet{background:purple;}

/* Shake */
.shake{animation:shake .3s}
@keyframes shake{0%{transform:translate(0,0)}25%{transform:translate(-8px,6px)}50%{transform:translate(8px,-6px)}75%{transform:translate(-6px,4px)}100%{transform:translate(0,0)}}

/* Snow */
#snow{position:absolute;inset:0;pointer-events:none;z-index:1}
.snowflake{position:absolute;width:4px;height:4px;background:#fff;border-radius:50%;opacity:.8;animation:fall linear infinite}
@keyframes fall{from{transform:translateY(-10px)}to{transform:translateY(110vh)}}

/* Menu Overlay */
#menuOverlay{position:absolute;inset:0;background:rgba(0,0,0,0.7);z-index:10;display:none;flex-direction:column;align-items:center;justify-content:center;pointer-events:auto;}
#menuOverlay button{margin:8px 0;width:180px;}
</style>
</head>
<body>
<div id="snow"></div>

<div id="startScreen" class="screen active">
  <h1>Catch the Gifts</h1>
  <label><input type="radio" name="difficulty" value="easy" checked> Easy</label>
  <label><input type="radio" name="difficulty" value="normal"> Normal</label>
  <label><input type="radio" name="difficulty" value="hard"> Hard</label>
  <label><input type="radio" name="difficulty" value="super"> Super Hard</label>
  <label><input type="radio" name="difficulty" value="insane"> Insane</label>
  <button id="startBtn">Start Game</button>
</div>

<div id="gameScreen" class="screen">
  <div class="hud">
    <div id="score">Score: 0</div>
    <div id="timer">Time: 30</div>
  </div>
  <div id="multiplier">Multiplier: x1</div>
  <div id="shieldEl">Shield Ready</div>
  <div id="shieldBubble"></div>
  <button id="fullscreenBtn">Fullscreen</button>
  <button id="menuBtn">Menu</button>
  <div id="gameArea">
    <div id="player"></div>
  </div>
</div>

<div id="menuOverlay">
  <button id="resumeBtn">Resume Game</button>
  <button id="toggleSoundBtn">Toggle Sound</button>
  <button id="toggleMusicBtn">Toggle Music</button>
  <button id="exitBtn">Return to Start Screen</button>
</div>

<div id="endScreen" class="screen">
  <h2>Game Over</h2>
  <p id="finalScore"></p>
  <p id="highScore"></p>
  <button id="playAgainBtn">Play Again</button>
</div>

<script>
const AudioCtx=window.AudioContext||window.webkitAudioContext;
const audioCtx=new AudioCtx();
let soundOn=true, musicOn=true, musicGain=null;

/* Music: Soft looping melody */
function startMusic(){
  if(!musicOn || musicGain) return;
  if(audioCtx.state==="suspended") audioCtx.resume();
  musicGain=audioCtx.createGain();
  musicGain.gain.value=0.02;
  musicGain.connect(audioCtx.destination);

  const notes=[261.63,329.63,392.00,523.25]; // C E G C
  let i=0;
  function playNote(){
    if(!musicOn){musicGain.disconnect(); musicGain=null; return;}
    const osc=audioCtx.createOscillator();
    osc.frequency.value=notes[i%notes.length];
    osc.type="sine";
    osc.connect(musicGain);
    osc.start();
    osc.stop(audioCtx.currentTime+0.3);
    i++;
    setTimeout(playNote, 300);
  }
  playNote();
}
function stopMusic(){musicGain&&musicGain.disconnect(); musicGain=null;}

/* Beep / bomb sounds */
function beep(f,d=0.15){if(!soundOn)return;if(audioCtx.state==="suspended") audioCtx.resume();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.frequency.value=f;o.connect(g);g.connect(audioCtx.destination);o.start();g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+d);o.stop(audioCtx.currentTime+d);}
function bombSound(){if(!soundOn)return;if(audioCtx.state==="suspended")audioCtx.resume();const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();osc.type="sine";osc.frequency.setValueAtTime(40,audioCtx.currentTime);osc.frequency.exponentialRampToValueAtTime(20,audioCtx.currentTime+0.6);gain.gain.setValueAtTime(1,audioCtx.currentTime);gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.6);osc.connect(gain).connect(audioCtx.destination);osc.start();osc.stop(audioCtx.currentTime+0.6);}

/* Elements */
const startScreen=document.getElementById("startScreen");
const gameScreen=document.getElementById("gameScreen");
const endScreen=document.getElementById("endScreen");
const player=document.getElementById("player");
const gameArea=document.getElementById("gameArea");
const scoreEl=document.getElementById("score");
const timerEl=document.getElementById("timer");
const multEl=document.getElementById("multiplier");
const shieldEl=document.getElementById("shieldEl");
const shieldBubble=document.getElementById("shieldBubble");
const menuOverlay=document.getElementById("menuOverlay");

let score=0,mult=1,timeLeft=30;
let objs=[],spawnInt=null,timerInt=null,running=false,diff;
let shield=false,shieldUsed=false;
let powerActive=null,powerTimer=null;
let menuActive=false;

/* Difficulties */
const difficulties={easy:{speed:2,spawn:900,bomb:0.08,time:30},normal:{speed:4,spawn:600,bomb:0.15,time:30},hard:{speed:6,spawn:400,bomb:0.25,time:30},super:{speed:9,spawn:260,bomb:0.40,time:30},insane:{speed:13,spawn:180,bomb:0.50,time:20}};

/* Start / Play Again */
document.getElementById("startBtn").onclick=()=>{
  diff=difficulties[document.querySelector('input[name="difficulty"]:checked').value];
  startScreen.classList.remove("active");
  gameScreen.classList.add("active");
  startGame();
  startMusic();
};
document.getElementById("playAgainBtn").onclick=()=>{endScreen.classList.remove("active"); startScreen.classList.add("active");}

/* Fullscreen */
document.getElementById("fullscreenBtn").onclick=()=>{if(!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen();}

/* Menu */
document.getElementById("menuBtn").onclick=()=>{menuActive=true; menuOverlay.style.display="flex";}
document.getElementById("resumeBtn").onclick=()=>{menuActive=false; menuOverlay.style.display="none";}
document.getElementById("toggleSoundBtn").onclick=()=>{soundOn=!soundOn; alert("Sound "+(soundOn?"ON":"OFF"));}
document.getElementById("toggleMusicBtn").onclick=()=>{musicOn=!musicOn; if(musicOn) startMusic(); else stopMusic(); alert("Music "+(musicOn?"ON":"OFF"));}
document.getElementById("exitBtn").onclick=()=>{menuActive=false; menuOverlay.style.display="none"; gameScreen.classList.remove("active"); startScreen.classList.add("active");}

/* Start Game Logic */
function startGame(){clearInterval(spawnInt); clearInterval(timerInt); objs.forEach(o=>o.el.remove()); objs=[];score=0;mult=1;shield=false;shieldUsed=false;powerActive=null;timeLeft=diff.time; running=true; scoreEl.textContent="Score: 0"; multEl.textContent="Multiplier: x1"; timerEl.textContent="Time: "+timeLeft; shieldEl.style.display="none"; shieldBubble.style.display="none"; spawnInt=setInterval(()=>{if(!menuActive) spawnObj();},diff.spawn); timerInt=setInterval(()=>{if(!menuActive){timeLeft--; timerEl.textContent="Time: "+timeLeft;if(timeLeft<=0) endGame();}},1000);}

/* End Game */
function endGame(){running=false; clearInterval(spawnInt); clearInterval(timerInt); const high=Math.max(score,localStorage.getItem("ctgHigh")||0); localStorage.setItem("ctgHigh",high); document.getElementById("finalScore").textContent="Final Score: "+score; document.getElementById("highScore").textContent="High Score: "+high; gameScreen.classList.remove("active"); endScreen.classList.add("active");}

/* Spawn / Update / Player movement / Snow (same as before) */
// Code for spawnObj(), update(), movement, and snow remains same as previous working version
</script>
</body>
</html>
